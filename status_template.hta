<html>
<head>
<title>WhisperX Launcher Status</title>
<HTA:APPLICATION
  ID="WhisperXStatus"
  APPLICATIONNAME="WhisperX Launcher Status"
  BORDER="thin"
  BORDERSTYLE="normal"
  CAPTION="yes"
  SHOWINTASKBAR="yes"
  SINGLEINSTANCE="yes"
  SYSMENU="yes"
  WINDOWSTATE="normal"
/>
<style>
  body {
    font-family: Consolas, monospace;
    font-size: 12pt;
    background-color: #f4f4f4;
    color: #222;
    margin: 0;
    padding: 10px;
  }
  #status {
    white-space: pre-wrap;
    word-wrap: break-word;
  }
</style>
<script language="VBScript">
Option Explicit

Dim logPath

Sub Window_OnLoad()
  logPath = "{{TEMP_LOG}}"
  Dim w, h
  w = 600
  h = 300
  window.resizeTo w, h
  window.moveTo (screen.availWidth - w) \ 2, (screen.availHeight - h) \ 2
  window.setInterval "UpdateStatus", 1000
End Sub

Sub UpdateStatus()
  On Error Resume Next
  Dim fso, ts, lines, line, i, displayText
  Set fso = CreateObject("Scripting.FileSystemObject")
  If fso.FileExists(logPath) Then
    Set ts = fso.OpenTextFile(logPath, 1, False, -1)
    lines = Split(ts.ReadAll, vbCrLf)
    ts.Close
    displayText = ""
    For i = UBound(lines) - 9 To UBound(lines)
      If i >= 0 Then
        line = lines(i)
        If InStr(LCase(line), "error") > 0 Then
          displayText = displayText & vbCrLf & "[ERROR] " & line
        ElseIf InStr(LCase(line), "warn") > 0 Then
          displayText = displayText & vbCrLf & "[WARN] " & line
        Else
          displayText = displayText & vbCrLf & line
        End If
      End If
    Next
    document.getElementById("status").innerText = Trim(displayText)
  Else
    document.getElementById("status").innerText = "Waiting for status log..."
  End If
  On Error GoTo 0
End Sub
</script>